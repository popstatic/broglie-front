{"ast":null,"code":"import { prop, withId, withIds } from '../utils';\nimport { unitsToNodes } from '../utils/units';\nimport { setDefaultUnitShift } from '../utils/setDefaultUnitShift';\n\nconst moveSharedUnitToRight = sharedIDs => (a, b) => {\n  const foundA = a.nodes.some(withIds(sharedIDs));\n  const foundB = b.nodes.some(withIds(sharedIDs));\n  if (foundA && !foundB) return 1;\n  if (!foundA && foundB) return -1;\n  return 0;\n};\n\nconst sameIn = units => {\n  const target = unitsToNodes(units);\n  return node => target.some(withId(node.id));\n};\n\nexport const correctOverlaps = (bloodFamily, adoptedFamily) => {\n  const sharedIDs = unitsToNodes(bloodFamily.children).filter(sameIn(adoptedFamily.children)).map(prop('id'));\n  const cachePos = bloodFamily.children.map(prop('pos'));\n  bloodFamily.children = [...bloodFamily.children].sort(moveSharedUnitToRight(sharedIDs));\n  bloodFamily.children.forEach((unit, idx) => unit.pos = cachePos[idx]);\n  adoptedFamily.children = adoptedFamily.children.filter(unit => unit.nodes.some(withIds(sharedIDs, false)));\n  setDefaultUnitShift(adoptedFamily);\n};","map":{"version":3,"sources":["/var/projets/broglie-social-react/sociala-react/node_modules/relatives-tree/lib/middle/correctOverlaps.js"],"names":["prop","withId","withIds","unitsToNodes","setDefaultUnitShift","moveSharedUnitToRight","sharedIDs","a","b","foundA","nodes","some","foundB","sameIn","units","target","node","id","correctOverlaps","bloodFamily","adoptedFamily","children","filter","map","cachePos","sort","forEach","unit","idx","pos"],"mappings":"AAAA,SAASA,IAAT,EAAeC,MAAf,EAAuBC,OAAvB,QAAsC,UAAtC;AACA,SAASC,YAAT,QAA6B,gBAA7B;AACA,SAASC,mBAAT,QAAoC,8BAApC;;AACA,MAAMC,qBAAqB,GAAIC,SAAD,IAAgB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACpD,QAAMC,MAAM,GAAGF,CAAC,CAACG,KAAF,CAAQC,IAAR,CAAaT,OAAO,CAACI,SAAD,CAApB,CAAf;AACA,QAAMM,MAAM,GAAGJ,CAAC,CAACE,KAAF,CAAQC,IAAR,CAAaT,OAAO,CAACI,SAAD,CAApB,CAAf;AACA,MAAIG,MAAM,IAAI,CAACG,MAAf,EACI,OAAO,CAAP;AACJ,MAAI,CAACH,MAAD,IAAWG,MAAf,EACI,OAAO,CAAC,CAAR;AACJ,SAAO,CAAP;AACH,CARD;;AASA,MAAMC,MAAM,GAAIC,KAAD,IAAW;AACtB,QAAMC,MAAM,GAAGZ,YAAY,CAACW,KAAD,CAA3B;AACA,SAAQE,IAAD,IAAUD,MAAM,CAACJ,IAAP,CAAYV,MAAM,CAACe,IAAI,CAACC,EAAN,CAAlB,CAAjB;AACH,CAHD;;AAIA,OAAO,MAAMC,eAAe,GAAG,CAACC,WAAD,EAAcC,aAAd,KAAgC;AAC3D,QAAMd,SAAS,GAAGH,YAAY,CAACgB,WAAW,CAACE,QAAb,CAAZ,CACbC,MADa,CACNT,MAAM,CAACO,aAAa,CAACC,QAAf,CADA,EAEbE,GAFa,CAETvB,IAAI,CAAC,IAAD,CAFK,CAAlB;AAGA,QAAMwB,QAAQ,GAAGL,WAAW,CAACE,QAAZ,CAAqBE,GAArB,CAAyBvB,IAAI,CAAC,KAAD,CAA7B,CAAjB;AACAmB,EAAAA,WAAW,CAACE,QAAZ,GAAuB,CAAC,GAAGF,WAAW,CAACE,QAAhB,EAA0BI,IAA1B,CAA+BpB,qBAAqB,CAACC,SAAD,CAApD,CAAvB;AACAa,EAAAA,WAAW,CAACE,QAAZ,CAAqBK,OAArB,CAA6B,CAACC,IAAD,EAAOC,GAAP,KAAeD,IAAI,CAACE,GAAL,GAAWL,QAAQ,CAACI,GAAD,CAA/D;AACAR,EAAAA,aAAa,CAACC,QAAd,GAAyBD,aAAa,CAACC,QAAd,CACpBC,MADoB,CACbK,IAAI,IAAIA,IAAI,CAACjB,KAAL,CAAWC,IAAX,CAAgBT,OAAO,CAACI,SAAD,EAAY,KAAZ,CAAvB,CADK,CAAzB;AAEAF,EAAAA,mBAAmB,CAACgB,aAAD,CAAnB;AACH,CAVM","sourcesContent":["import { prop, withId, withIds } from '../utils';\nimport { unitsToNodes } from '../utils/units';\nimport { setDefaultUnitShift } from '../utils/setDefaultUnitShift';\nconst moveSharedUnitToRight = (sharedIDs) => ((a, b) => {\n    const foundA = a.nodes.some(withIds(sharedIDs));\n    const foundB = b.nodes.some(withIds(sharedIDs));\n    if (foundA && !foundB)\n        return 1;\n    if (!foundA && foundB)\n        return -1;\n    return 0;\n});\nconst sameIn = (units) => {\n    const target = unitsToNodes(units);\n    return (node) => target.some(withId(node.id));\n};\nexport const correctOverlaps = (bloodFamily, adoptedFamily) => {\n    const sharedIDs = unitsToNodes(bloodFamily.children)\n        .filter(sameIn(adoptedFamily.children))\n        .map(prop('id'));\n    const cachePos = bloodFamily.children.map(prop('pos'));\n    bloodFamily.children = [...bloodFamily.children].sort(moveSharedUnitToRight(sharedIDs));\n    bloodFamily.children.forEach((unit, idx) => unit.pos = cachePos[idx]);\n    adoptedFamily.children = adoptedFamily.children\n        .filter(unit => unit.nodes.some(withIds(sharedIDs, false)));\n    setDefaultUnitShift(adoptedFamily);\n};\n"]},"metadata":{},"sourceType":"module"}