{"ast":null,"code":"import { DEFAULT_STATE, MAX_ZOOM, MIN_ZOOM } from './constants';\nimport { getClientXY, getScale, getTouchesRange, getWheelDelta, isTouch, isTouchEvent, limitZoom } from './helpers';\nexport default function create(_ref) {\n  var element = _ref.element,\n      _ref$minZoom = _ref.minZoom,\n      minZoom = _ref$minZoom === void 0 ? MIN_ZOOM : _ref$minZoom,\n      _ref$maxZoom = _ref.maxZoom,\n      maxZoom = _ref$maxZoom === void 0 ? MAX_ZOOM : _ref$maxZoom,\n      captureWheel = _ref.captureWheel;\n  var touch = isTouch();\n  var action = 'none';\n  var state = DEFAULT_STATE;\n  var current = {\n    x: 0,\n    y: 0,\n    z: 0,\n    range: 0\n  };\n\n  function setState(value) {\n    state = value;\n    var point = element.children.item(0);\n    if (point) point.style.transform = \"translate(\".concat(value.x, \"px, \").concat(value.y, \"px) scale(\").concat(value.z, \")\");\n  }\n\n  function setCurrentXY(_ref2) {\n    var X = _ref2.X,\n        Y = _ref2.Y;\n    current.x = X;\n    current.y = Y;\n  }\n\n  function startMoving(event) {\n    action = 'move';\n    setCurrentXY(getClientXY(event));\n  }\n\n  function setPosition(z, pageX, pageY) {\n    var _element$getBoundingC = element.getBoundingClientRect(),\n        left = _element$getBoundingC.left,\n        top = _element$getBoundingC.top;\n\n    var ratio = z / state.z;\n    var offsetX = pageX - left - window.pageXOffset - state.x;\n    var offsetY = pageY - top - window.pageYOffset - state.y;\n    setState({\n      x: state.x - (offsetX * ratio - offsetX),\n      y: state.y - (offsetY * ratio - offsetY),\n      z: z\n    });\n  }\n\n  function onStart(event) {\n    event.preventDefault();\n\n    if (isTouchEvent(event) && event.touches.length === 2) {\n      action = 'pinch';\n      current.z = state.z;\n      current.range = getTouchesRange(event);\n    } else startMoving(event);\n  }\n\n  function onMove(event) {\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    if (action === 'move') {\n      var clientXY = getClientXY(event);\n      var x = state.x - (current.x - clientXY.X);\n      var y = state.y - (current.y - clientXY.Y);\n      setCurrentXY(clientXY);\n      setState({\n        x: x,\n        y: y,\n        z: state.z\n      });\n    } else if (action === 'pinch') {\n      var _getScale = getScale(event, current.range),\n          scale = _getScale.scale,\n          pageX = _getScale.pageX,\n          pageY = _getScale.pageY;\n\n      var z = limitZoom(current.z * scale, minZoom, maxZoom);\n      setPosition(z, pageX, pageY);\n    }\n  }\n\n  function onEnd(event) {\n    if (action === 'pinch' && isTouchEvent(event) && event.touches.length === 1) startMoving(event);else action = 'none';\n  }\n\n  function onWheel(event) {\n    if (!captureWheel && !event.altKey) return;\n    event.preventDefault();\n    event.stopPropagation();\n    var delta = getWheelDelta(event) * -1;\n    var z = limitZoom(state.z + delta, minZoom, maxZoom);\n    setPosition(z, event.pageX, event.pageY);\n  }\n\n  var events = [{\n    type: touch ? 'touchstart' : 'mousedown',\n    listener: onStart\n  }, {\n    type: touch ? 'touchmove' : 'mousemove',\n    listener: onMove\n  }, {\n    type: touch ? 'touchend' : 'mouseup',\n    listener: onEnd\n  }, {\n    type: touch ? 'touchleave' : 'mouseleave',\n    listener: onEnd\n  }, {\n    type: 'touchcancel',\n    listener: onEnd\n  }, {\n    type: 'wheel',\n    listener: onWheel\n  }];\n\n  var _element$getBoundingC2 = element.getBoundingClientRect(),\n      width = _element$getBoundingC2.width,\n      height = _element$getBoundingC2.height;\n\n  setState({\n    x: width / 2,\n    y: height / 2,\n    z: state.z\n  });\n  events.forEach(function (_ref3) {\n    var type = _ref3.type,\n        listener = _ref3.listener;\n    return element.addEventListener(type, listener);\n  });\n  return function () {\n    return events.forEach(function (_ref4) {\n      var type = _ref4.type,\n          listener = _ref4.listener;\n      return element.removeEventListener(type, listener);\n    });\n  };\n}","map":{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"AAAA,SAAS,aAAT,EAAwB,QAAxB,EAAkC,QAAlC,QAAkD,aAAlD;AACA,SAAS,WAAT,EAAsB,QAAtB,EAAgC,eAAhC,EAAiD,aAAjD,EAAgE,OAAhE,EAAyE,YAAzE,EAAuF,SAAvF,QAAwG,WAAxG;AAiBA,eAAM,SAAiB,MAAjB,OAAsG;AAAA,MAA5E,OAA4E,QAA5E,OAA4E;AAAA,0BAAnE,OAAmE;AAAA,MAAnE,OAAmE,6BAAxD,QAAwD;AAAA,0BAA/C,OAA+C;AAAA,MAA/C,OAA+C,6BAApC,QAAoC;AAAA,MAAlC,YAAkC,QAAlC,YAAkC;AAC1G,MAAM,KAAK,GAAG,OAAO,EAArB;AAEA,MAAI,MAAM,GAAW,MAArB;AACA,MAAI,KAAK,GAA2B,aAApC;AACA,MAAM,OAAO,GAAqC;AAAE,IAAA,CAAC,EAAE,CAAL;AAAQ,IAAA,CAAC,EAAE,CAAX;AAAc,IAAA,CAAC,EAAE,CAAjB;AAAoB,IAAA,KAAK,EAAE;AAA3B,GAAlD;;AAGA,WAAS,QAAT,CAAkB,KAAlB,EAA+C;AAC7C,IAAA,KAAK,GAAG,KAAR;AACA,QAAM,KAAK,GAAG,OAAO,CAAC,QAAR,CAAiB,IAAjB,CAAsB,CAAtB,CAAd;AACA,QAAI,KAAJ,EAAY,KAAqB,CAAC,KAAtB,CAA4B,SAA5B,uBAAqD,KAAK,CAAC,CAA3D,iBAAmE,KAAK,CAAC,CAAzE,uBAAuF,KAAK,CAAC,CAA7F;AACb;;AAED,WAAS,YAAT,QAAwD;AAAA,QAAhC,CAAgC,SAAhC,CAAgC;AAAA,QAA7B,CAA6B,SAA7B,CAA6B;AACtD,IAAA,OAAO,CAAC,CAAR,GAAY,CAAZ;AACA,IAAA,OAAO,CAAC,CAAR,GAAY,CAAZ;AACD;;AAED,WAAS,WAAT,CAAqB,KAArB,EAAmD;AACjD,IAAA,MAAM,GAAG,MAAT;AACA,IAAA,YAAY,CAAC,WAAW,CAAC,KAAD,CAAZ,CAAZ;AACD;;AAGD,WAAS,WAAT,CAAqB,CAArB,EAAgC,KAAhC,EAA+C,KAA/C,EAA4D;AAC1D,gCAAsB,OAAO,CAAC,qBAAR,EAAtB;AAAA,QAAQ,IAAR,yBAAQ,IAAR;AAAA,QAAc,GAAd,yBAAc,GAAd;;AAEA,QAAM,KAAK,GAAG,CAAC,GAAG,KAAK,CAAC,CAAxB;AACA,QAAM,OAAO,GAAI,KAAK,GAAG,IAAR,GAAe,MAAM,CAAC,WAAvB,GAAsC,KAAK,CAAC,CAA5D;AACA,QAAM,OAAO,GAAI,KAAK,GAAG,GAAR,GAAc,MAAM,CAAC,WAAtB,GAAqC,KAAK,CAAC,CAA3D;AAEA,IAAA,QAAQ,CAAC;AACP,MAAA,CAAC,EAAE,KAAK,CAAC,CAAN,IAAY,OAAO,GAAG,KAAX,GAAoB,OAA/B,CADI;AAEP,MAAA,CAAC,EAAE,KAAK,CAAC,CAAN,IAAY,OAAO,GAAG,KAAX,GAAoB,OAA/B,CAFI;AAGP,MAAA,CAAC,EAAD;AAHO,KAAD,CAAR;AAKD;;AAED,WAAS,OAAT,CAAiB,KAAjB,EAA+C;AAC7C,IAAA,KAAK,CAAC,cAAN;;AAEA,QAAI,YAAY,CAAC,KAAD,CAAZ,IAAuB,KAAK,CAAC,OAAN,CAAc,MAAd,KAAyB,CAApD,EAAuD;AACrD,MAAA,MAAM,GAAG,OAAT;AACA,MAAA,OAAO,CAAC,CAAR,GAAY,KAAK,CAAC,CAAlB;AACA,MAAA,OAAO,CAAC,KAAR,GAAgB,eAAe,CAAC,KAAD,CAA/B;AACD,KAJD,MAKK,WAAW,CAAC,KAAD,CAAX;AACN;;AAED,WAAS,MAAT,CAAgB,KAAhB,EAA8C;AAC5C,IAAA,KAAK,CAAC,wBAAN;AACA,IAAA,KAAK,CAAC,cAAN;;AAEA,QAAI,MAAM,KAAK,MAAf,EAAuB;AACrB,UAAM,QAAQ,GAAG,WAAW,CAAC,KAAD,CAA5B;AACA,UAAM,CAAC,GAAG,KAAK,CAAC,CAAN,IAAW,OAAO,CAAC,CAAR,GAAY,QAAQ,CAAC,CAAhC,CAAV;AACA,UAAM,CAAC,GAAG,KAAK,CAAC,CAAN,IAAW,OAAO,CAAC,CAAR,GAAY,QAAQ,CAAC,CAAhC,CAAV;AACA,MAAA,YAAY,CAAC,QAAD,CAAZ;AACA,MAAA,QAAQ,CAAC;AAAE,QAAA,CAAC,EAAD,CAAF;AAAK,QAAA,CAAC,EAAD,CAAL;AAAQ,QAAA,CAAC,EAAE,KAAK,CAAC;AAAjB,OAAD,CAAR;AACD,KAND,MAOK,IAAI,MAAM,KAAK,OAAf,EAAwB;AAC3B,sBAAgC,QAAQ,CAAC,KAAD,EAAsB,OAAO,CAAC,KAA9B,CAAxC;AAAA,UAAQ,KAAR,aAAQ,KAAR;AAAA,UAAe,KAAf,aAAe,KAAf;AAAA,UAAsB,KAAtB,aAAsB,KAAtB;;AACA,UAAM,CAAC,GAAG,SAAS,CAAC,OAAO,CAAC,CAAR,GAAY,KAAb,EAAoB,OAApB,EAA6B,OAA7B,CAAnB;AACA,MAAA,WAAW,CAAC,CAAD,EAAI,KAAJ,EAAW,KAAX,CAAX;AACD;AACF;;AAED,WAAS,KAAT,CAAe,KAAf,EAA6C;AAC3C,QAAI,MAAM,KAAK,OAAX,IAAsB,YAAY,CAAC,KAAD,CAAlC,IAA6C,KAAK,CAAC,OAAN,CAAc,MAAd,KAAyB,CAA1E,EAA6E,WAAW,CAAC,KAAD,CAAX,CAA7E,KACK,MAAM,GAAG,MAAT;AACN;;AAED,WAAS,OAAT,CAAiB,KAAjB,EAAkC;AAChC,QAAI,CAAC,YAAD,IAAiB,CAAC,KAAK,CAAC,MAA5B,EAAoC;AACpC,IAAA,KAAK,CAAC,cAAN;AACA,IAAA,KAAK,CAAC,eAAN;AAEA,QAAM,KAAK,GAAG,aAAa,CAAC,KAAD,CAAb,GAAuB,CAAC,CAAtC;AACA,QAAM,CAAC,GAAG,SAAS,CAAC,KAAK,CAAC,CAAN,GAAU,KAAX,EAAkB,OAAlB,EAA2B,OAA3B,CAAnB;AACA,IAAA,WAAW,CAAC,CAAD,EAAI,KAAK,CAAC,KAAV,EAAiB,KAAK,CAAC,KAAvB,CAAX;AACD;;AAED,MAAM,MAAM,GAA8D,CACxE;AAAE,IAAA,IAAI,EAAE,KAAK,GAAG,YAAH,GAAkB,WAA/B;AAA4C,IAAA,QAAQ,EAAE;AAAtD,GADwE,EAExE;AAAE,IAAA,IAAI,EAAE,KAAK,GAAG,WAAH,GAAiB,WAA9B;AAA2C,IAAA,QAAQ,EAAE;AAArD,GAFwE,EAGxE;AAAE,IAAA,IAAI,EAAE,KAAK,GAAG,UAAH,GAAgB,SAA7B;AAAwC,IAAA,QAAQ,EAAE;AAAlD,GAHwE,EAIxE;AAAE,IAAA,IAAI,EAAE,KAAK,GAAG,YAAH,GAAkB,YAA/B;AAA6C,IAAA,QAAQ,EAAE;AAAvD,GAJwE,EAKxE;AAAE,IAAA,IAAI,EAAE,aAAR;AAAuB,IAAA,QAAQ,EAAE;AAAjC,GALwE,EAMxE;AAAE,IAAA,IAAI,EAAE,OAAR;AAAiB,IAAA,QAAQ,EAAE;AAA3B,GANwE,CAA1E;;AAUA,+BAA0B,OAAO,CAAC,qBAAR,EAA1B;AAAA,MAAQ,KAAR,0BAAQ,KAAR;AAAA,MAAe,MAAf,0BAAe,MAAf;;AACA,EAAA,QAAQ,CAAC;AAAE,IAAA,CAAC,EAAE,KAAK,GAAG,CAAb;AAAgB,IAAA,CAAC,EAAE,MAAM,GAAG,CAA5B;AAA+B,IAAA,CAAC,EAAE,KAAK,CAAC;AAAxC,GAAD,CAAR;AAGA,EAAA,MAAM,CAAC,OAAP,CAAe;AAAA,QAAG,IAAH,SAAG,IAAH;AAAA,QAAS,QAAT,SAAS,QAAT;AAAA,WAAwB,OAAO,CAAC,gBAAR,CAAyB,IAAzB,EAA+B,QAA/B,CAAxB;AAAA,GAAf;AAGA,SAAO;AAAA,WAAM,MAAM,CAAC,OAAP,CAAe;AAAA,UAAG,IAAH,SAAG,IAAH;AAAA,UAAS,QAAT,SAAS,QAAT;AAAA,aAAwB,OAAO,CAAC,mBAAR,CAA4B,IAA5B,EAAkC,QAAlC,CAAxB;AAAA,KAAf,CAAN;AAAA,GAAP;AACD","sourceRoot":"","sourcesContent":["import { DEFAULT_STATE, MAX_ZOOM, MIN_ZOOM } from './constants';\nimport { getClientXY, getScale, getTouchesRange, getWheelDelta, isTouch, isTouchEvent, limitZoom } from './helpers';\nexport default function create({ element, minZoom = MIN_ZOOM, maxZoom = MAX_ZOOM, captureWheel }) {\n    const touch = isTouch();\n    let action = 'none';\n    let state = DEFAULT_STATE;\n    const current = { x: 0, y: 0, z: 0, range: 0 };\n    function setState(value) {\n        state = value;\n        const point = element.children.item(0);\n        if (point)\n            point.style.transform = `translate(${value.x}px, ${value.y}px) scale(${value.z})`;\n    }\n    function setCurrentXY({ X, Y }) {\n        current.x = X;\n        current.y = Y;\n    }\n    function startMoving(event) {\n        action = 'move';\n        setCurrentXY(getClientXY(event));\n    }\n    function setPosition(z, pageX, pageY) {\n        const { left, top } = element.getBoundingClientRect();\n        const ratio = z / state.z;\n        const offsetX = (pageX - left - window.pageXOffset) - state.x;\n        const offsetY = (pageY - top - window.pageYOffset) - state.y;\n        setState({\n            x: state.x - ((offsetX * ratio) - offsetX),\n            y: state.y - ((offsetY * ratio) - offsetY),\n            z,\n        });\n    }\n    function onStart(event) {\n        event.preventDefault();\n        if (isTouchEvent(event) && event.touches.length === 2) {\n            action = 'pinch';\n            current.z = state.z;\n            current.range = getTouchesRange(event);\n        }\n        else\n            startMoving(event);\n    }\n    function onMove(event) {\n        event.stopImmediatePropagation();\n        event.preventDefault();\n        if (action === 'move') {\n            const clientXY = getClientXY(event);\n            const x = state.x - (current.x - clientXY.X);\n            const y = state.y - (current.y - clientXY.Y);\n            setCurrentXY(clientXY);\n            setState({ x, y, z: state.z });\n        }\n        else if (action === 'pinch') {\n            const { scale, pageX, pageY } = getScale(event, current.range);\n            const z = limitZoom(current.z * scale, minZoom, maxZoom);\n            setPosition(z, pageX, pageY);\n        }\n    }\n    function onEnd(event) {\n        if (action === 'pinch' && isTouchEvent(event) && event.touches.length === 1)\n            startMoving(event);\n        else\n            action = 'none';\n    }\n    function onWheel(event) {\n        if (!captureWheel && !event.altKey)\n            return;\n        event.preventDefault();\n        event.stopPropagation();\n        const delta = getWheelDelta(event) * -1;\n        const z = limitZoom(state.z + delta, minZoom, maxZoom);\n        setPosition(z, event.pageX, event.pageY);\n    }\n    const events = [\n        { type: touch ? 'touchstart' : 'mousedown', listener: onStart },\n        { type: touch ? 'touchmove' : 'mousemove', listener: onMove },\n        { type: touch ? 'touchend' : 'mouseup', listener: onEnd },\n        { type: touch ? 'touchleave' : 'mouseleave', listener: onEnd },\n        { type: 'touchcancel', listener: onEnd },\n        { type: 'wheel', listener: onWheel },\n    ];\n    const { width, height } = element.getBoundingClientRect();\n    setState({ x: width / 2, y: height / 2, z: state.z });\n    events.forEach(({ type, listener }) => element.addEventListener(type, listener));\n    return () => events.forEach(({ type, listener }) => element.removeEventListener(type, listener));\n}\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}